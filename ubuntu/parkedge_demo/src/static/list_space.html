<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParkEdge - List Your Space</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <h1>ParkEdge</h1>
        <nav>
            <a href="/map_view.html">Find Parking</a>
            <a href="/list_space.html">List Your Space</a>
        </nav>
    </header>
    <main>
        <h2>List Your Driveway/Parking Space</h2>
        <form id="list-space-form">
            <div>
                <label for="address">Address:</label>
                <input type="text" id="address" name="address" required>
            </div>
            <div>
                <label for="latitude">Latitude:</label>
                <input type="number" id="latitude" name="latitude" step="any" required>
                <small>Tip: Use Google Maps to find coordinates.</small>
            </div>
            <div>
                <label for="longitude">Longitude:</label>
                <input type="number" id="longitude" name="longitude" step="any" required>
            </div>
            <div>
                <label for="price">Price (e.g., $5/hr, $20/day):</label>
                <input type="text" id="price" name="price" required>
            </div>
            <button type="submit">List My Space</button>
        </form>
        <p id="form-message"></p>
    </main>
    <footer>
        <p>&copy; 2025 ParkEdge</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("list-space-form");
            const formMessage = document.getElementById("form-message");

            form.addEventListener("submit", (event) => {
                event.preventDefault();
                formMessage.textContent = "Submitting...";

                const formData = new FormData(form);
                const data = {
                    address: formData.get("address"),
                    latitude: parseFloat(formData.get("latitude")),
                    longitude: parseFloat(formData.get("longitude")),
                    price: formData.get("price")
                };

                fetch("/api/spaces", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(err.error || `HTTP error! status: ${response.status}`);
                        });
                    }
                    return response.json();
                })
                .then(newSpace => {
                    formMessage.textContent = `Space listed successfully! Address: ${newSpace.address}`;
                    formMessage.style.color = "green";
                    form.reset();
                })
                .catch(error => {
                    console.error("Error listing space:", error);
                    formMessage.textContent = `Error: ${error.message}`;
                    formMessage.style.color = "red";
                });
            });
        });
    </script>
</body>
</html>

